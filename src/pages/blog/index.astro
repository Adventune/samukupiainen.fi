---
import { Image } from 'astro:assets';
import { getCollection } from 'astro:content';
import BaseHead from '../../components/BaseHead.astro';
import Footer from '../../components/Footer.astro';
import FormattedDate from '../../components/FormattedDate.astro';
import Header from '../../components/Header.astro';
import { SITE_DESCRIPTION, SITE_TITLE } from '../../consts';

const posts = (await getCollection('blog'))
    .sort((a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf())
    .filter((post) => (post.data.published !== undefined ? post.data.published : true));
---

<!doctype html>
<html lang='en'>
    <head>
        <BaseHead title={SITE_TITLE} description={SITE_DESCRIPTION} />
    </head>
    <Header />
    <body class='min-h-screen'>
        <main class='mt-32 items-center flex flex-col gap-4'>
            <h1>Blog</h1>
            <section>
                <ul class='md:grid lg:grid-cols-3 md:grid-cols-2 flex flex-col gap-6 p-4 md:p-16'>
                    {
                        posts.map((post) => (
                            <li>
                                <a
                                    href={`/blog/${post.id}/`}
                                    class='h-full w-fit flex flex-col gap-2 no-underline bg-secondary-dark rounded-lg overflow-hidden drop-shadow-lg'
                                >
                                    {post.data.heroImage && (
                                        <div class='full h-40 object-cover flex justify-center items-center overflow-hidden'>
                                            <Image
                                                width={720}
                                                height={360}
                                                src={post.data.heroImage}
                                                alt=''
                                                class='inline'
                                            />
                                        </div>
                                    )}
                                    <div class='flex flex-col p-2'>
                                        <h4 class='m-0 text-xl'>{post.data.title}</h4>
                                        <p class='text-light-text'>
                                            <FormattedDate date={post.data.pubDate} />
                                        </p>
                                        <p class='text-light-text md:w-3/4 line-clamp-3'>
                                            {post.data.description}
                                        </p>
                                    </div>
                                </a>
                            </li>
                        ))
                    }
                </ul>
            </section>
        </main>
    </body>
    <Footer />
</html>
